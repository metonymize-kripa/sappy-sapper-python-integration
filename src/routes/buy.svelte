<svelte:head>
	<title>Buy</title>
</svelte:head>
<style>
    body {
        max-width:80rem;
        margin:0 auto;
    }
   	.neutral{
        color:black;
	}
	.bearish{
		color:red;
	}
	.bullish{
		color:green;
	}
    .no-emphasis{
    font-weight:100;
    }
    emphasis{
    font-weight:1800;
    }
</style>
<script>
    import { stores } from '@sapper/app';
    const { preloading, page, session } = stores();
    let symbol_list = ["LBRDK","IAC","TWTR","SE","MELI","PYPL","PTON","CHNG","CVNA","MU","PINS","DIS","WFC","C","GDDY","GME","PLTR","SPY","TSLA","AMC","NIO","TLRY","APHA","RBLX","AAPL","SNDL","AMD","GE","RKT","QQQ"];
    //let symbol_list = ["LBRDK", "IAC", "TWTR", "SE", "MELI", "GME", "RBLX", "AMC", "TSLA", "PLTR"];
    //let symbol_list = ["LBRDK","IAC","TWTR","SE","MELI","GME","TSLA","AMC","PLTR","SPY"];
    //let table_dict= {};
    let table_list=[];
    let table_show = [];
    for(var i = 0; i < symbol_list.length; i++)
    {
        table_list.push({"symbol":symbol_list[i].toUpperCase(),"kelly":"NA","prob_up":"NA"});
        //table_dict[symbol_list[i].toUpperCase()] = {"kelly":"NA","prob_up":"NA"}
    }
    function compare( a, b ) {
      if ( parseFloat(a.kelly) > parseFloat(b.kelly) ){
        return -1;
      }
      if ( parseFloat(a.kelly) < parseFloat(b.kelly)){
        return 1;
      }
      return 0;
    }
    function get_portfolio_data() {

        for(var i = 0; i < table_list.length; i++)
        {
            fetch("https://www.insuremystock.com/options/prob_pct/"+table_list[i]['symbol']+"?days=7&percent=10")
            .then(d => d.text())
            .then(function(d) {
                var my_dict = JSON.parse(d);
                for (var k = 0; k < table_list.length; k++)
                {
                    if (table_list[k].symbol == my_dict.symbol.toUpperCase())
                    {
                        table_list[k].prob_up = Math.round(my_dict.prob_up*100);
                    }
                }
              });

              fetch("https://www.insuremystock.com/options/kelly/"+table_list[i]['symbol'])
              .then(d => d.text())
              .then(function(d) {
                  var my_dict = JSON.parse(d);
                  for (var k = 0; k < table_list.length; k++)
                  {
                      if (table_list[k].symbol == my_dict.symbol.toUpperCase())
                      {
                          table_list[k].kelly = (my_dict.kelly2*100).toFixed(2);
                      }
                }
                });
        }
        table_list = table_list.sort(compare);
    }

get_portfolio_data();

</script>

<h1>Picks for daily spread</h1>

<table class="striped">

    <thead>
        <tr>
          <th class="emphasis">Symbol</th>
          <th class="emphasis">$ to invest*</th>
          <th class="no-emphasis">Windfall ChanceðŸ”±</th>

        </tr>
    </thead>
    <tbody>
        {#each table_list as { symbol,kelly,prob_up}, i}
        {#if kelly>0}
            <tr class="bullish">
                <td class="emphasis"> <a  href="/?symbol={symbol}&cmd=call">{symbol}</a></td>
                <td class="emphasis">${kelly}</td>
                <td class="no-emphasis">{prob_up}%</td>
            </tr>
            {:else}
            <tr class="bearish">
                <td class="emphasis"> <a class="bearish" href="/?symbol={symbol}&cmd=call">{symbol}</a></td>
                <td class="emphasis">${kelly}</td>
                <td class="no-emphasis">{prob_up}%</td>
            </tr>
            {/if}
        {/each}
    </tbody>
</table>
<br>
<button class="pull-left button primary" on:click={get_portfolio_data}>
    Sort
</button>
<br><br><br>
* - Optimal allocation amounts for a $100 portfolio
<br>
ðŸ”± - Probability that the stock moves up 10% in a week
