<svelte:head>
	<title>My Calls </title>
</svelte:head>
<style>
   	.neutral{
        color:black;
	}
	.bearish{
		color:red;
	}
	.bullish{
		color:green;
	}
</style>
<script>
    let symbol_list = ["ABBV","GILD","GME","IBM","MO","T","XOM"];
    let table_list= [];
    for(var i = 0; i < symbol_list.length; i++)
    {
        table_list.push({"symbol":symbol_list[i],"call_1wk":"NA","call_2wk":"NA","call_4wk":"NA"});
    }
    function get_portfolio_data() {
		fetch("https://www.insuremystock.com/helper/brad")
		.then(d => d.text())
		.then(function(d) {

			var my_dict = JSON.parse(d);
			for (var k = 0; k < table_list.length; k++)
			{
				var my_vals = my_dict[table_list[k].symbol.toUpperCase()];
				console.log(my_vals);

				if (my_vals[0].strike > 0)
					table_list[k].call_1wk = "$"+my_vals[0].strike+"("+my_vals[0].expiry+"): $"+my_vals[0].bid+"-$"+my_vals[0].ask;
				if (my_vals[1].strike > 0)
					table_list[k].call_2wk = "$"+my_vals[1].strike+"("+my_vals[1].expiry+"): $"+my_vals[1].bid+"-$"+my_vals[1].ask;
				if (my_vals[2].strike > 0)
					table_list[k].call_4wk = "$"+my_vals[2].strike+"("+my_vals[2].expiry+"): $"+my_vals[2].bid+"-$"+my_vals[2].ask;
			}
		  });
		 /*
        for(var i = 0; i < table_list.length; i++)
        {
        fetch("https://www.insuremystock.com/options/call_trades/"+table_list[i]['symbol'])
        .then(d => d.text())
        .then(function(d) {

            var my_dict = JSON.parse(d);
            for (var k = 0; k < table_list.length; k++)
            {
                if (table_list[k].symbol.toUpperCase() == my_dict.symbol.toUpperCase())
                {
                    if (my_dict.best_call.strike > 0)
                        table_list[k].call_1wk = "$"+my_dict.best_call.strike+"("+my_dict.best_call.expiry+"): $"+my_dict.best_call.bid+"-$"+my_dict.best_call.ask;
                }
            }
          });
          fetch("https://www.insuremystock.com/options/call_trades/"+table_list[i]['symbol']+"/?days=14")
          .then(d => d.text())
          .then(function(d) {

              var my_dict = JSON.parse(d);
              for (var k = 0; k < table_list.length; k++)
              {
                  if (table_list[k].symbol.toUpperCase() == my_dict.symbol.toUpperCase())
                  {
                      if (my_dict.best_call.strike > 0)
                          table_list[k].call_2wk = "$"+my_dict.best_call.strike+"("+my_dict.best_call.expiry+"): $"+my_dict.best_call.bid+"-$"+my_dict.best_call.ask;
                  }
              }
            });

            fetch("https://www.insuremystock.com/options/call_trades/"+table_list[i]['symbol']+"/?days=28")
            .then(d => d.text())
            .then(function(d) {

                var my_dict = JSON.parse(d);
                for (var k = 0; k < table_list.length; k++)
                {
                    if (table_list[k].symbol.toUpperCase() == my_dict.symbol.toUpperCase())
                    {
                        if (my_dict.best_call.strike > 0)
                            table_list[k].call_4wk = "$"+my_dict.best_call.strike+"("+my_dict.best_call.expiry+"): $"+my_dict.best_call.bid+"-$"+my_dict.best_call.ask;
                    }
                }
              });


         }
		 */
    }
</script>

<h1>Optimal OTM Calls to Sell</h1>

<table class="striped">
    <caption>

    </caption>
    <thead>
        <tr>

          <th>Symbol</th>
          <th>1Wk</th>
          <th>2Wk</th>
          <th>4Wk</th>

        </tr>
    </thead>
    <tbody>
        {#each table_list as { symbol,call_1wk,call_2wk,call_4wk}, i}
            <tr class="bullish">
                <td>{symbol}</td>
                <td>{call_1wk}</td>
                <td>{call_2wk}</td>
                <td>{call_4wk}</td>
            </tr>

        {/each}
    </tbody>
</table>
<br>
<button class="pull-left button primary" on:click={get_portfolio_data()}>
    Get Data
</button>
